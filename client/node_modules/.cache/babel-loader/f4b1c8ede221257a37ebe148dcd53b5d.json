{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\n\nfunction _interopDefault(ex) {\n  return ex && typeof ex === 'object' && 'default' in ex ? ex['default'] : ex;\n}\n\nvar _tslib = require('../_tslib-bcbe0269.js');\n\nvar React = require('react');\n\nvar React__default = _interopDefault(React);\n\nvar defaultState = {\n  disableAnimations: false,\n  singletonComponents: {},\n  theme: \"light\"\n}; // This implementation is based on the excellent blog post by Kent C. Dodds on\n// How to use React Context effectively:\n// https://kentcdodds.com/blog/how-to-use-react-context-effectively\n\nvar SpaceKitStateContext = /*#__PURE__*/React__default.createContext(undefined);\nvar SpaceKitSetContext = /*#__PURE__*/React__default.createContext(undefined);\n/**\r\n * Provider to set options on all Space Kit components\r\n *\r\n * This is completely optional; components will not have issues if this is\r\n * missing from the context.\r\n *\r\n * A good place to use this would be in your storybook configuration as a\r\n * decorator applied to all components if we're running inside of chromatic.\r\n */\n\nvar SpaceKitProvider = function (_a) {\n  var _b;\n\n  var children = _a.children,\n      theme = _a.theme,\n      disableAnimations = _a.disableAnimations;\n  var nextState = React.useMemo(function () {\n    return {\n      theme: theme !== null && theme !== void 0 ? theme : defaultState.theme,\n      disableAnimations: disableAnimations !== null && disableAnimations !== void 0 ? disableAnimations : defaultState.disableAnimations,\n      singletonComponents: {}\n    };\n  }, [theme, disableAnimations]);\n\n  var _c = React__default.useState(nextState),\n      state = _c[0],\n      setState = _c[1];\n\n  React.useEffect(function () {\n    setState(function (currState) {\n      return _tslib.__assign(_tslib.__assign({}, nextState), {\n        singletonComponents: currState.singletonComponents\n      });\n    });\n  }, [nextState]);\n  return /*#__PURE__*/React__default.createElement(SpaceKitStateContext.Provider, {\n    value: state\n  }, /*#__PURE__*/React__default.createElement(SpaceKitSetContext.Provider, {\n    value: setState\n  }, Object.entries((_b = state === null || state === void 0 ? void 0 : state.singletonComponents) !== null && _b !== void 0 ? _b : {}).map(function (_a) {\n    var identity = _a[0],\n        element = _a[1].element;\n    return /*#__PURE__*/React__default.createElement(React__default.Fragment, {\n      key: identity\n    }, element);\n  }), children));\n};\n/**\r\n * Hook to indicate if the current component is being rendered inside of a\r\n * `SpaceKitProvider`\r\n */\n\n\nfunction useHasSpaceKitProvider() {\n  return !!React__default.useContext(SpaceKitStateContext);\n}\n/**\r\n * Hook to get the values from the Space Kit Provider with sensible defaults for\r\n * all the values.\r\n *\r\n * This component does _not_ require us to be wrapped with `SpaceKitProvider`\r\n */\n\n\nfunction useSpaceKitProvider() {\n  var context = React__default.useContext(SpaceKitStateContext);\n\n  if (context == null) {\n    // Provide a default because consumers are not required to wrap their\n    // components with our providers\n    return defaultState;\n  }\n\n  return context;\n}\n/**\r\n * Hook intended to be used internally to communicate with `SpaceKitProvider`\r\n * indicating singleton components being mounted and unmounted.\r\n *\r\n * Use `show` to track when you show a component.\r\n *\r\n * Use `hide` to track when you remove a component.\r\n */\n\n\nfunction useSingletonComponent() {\n  var setSpaceKitContext = React__default.useContext(SpaceKitSetContext);\n  var hide = React__default.useCallback(function (_a) {\n    var identity = _a.identity;\n    setSpaceKitContext === null || setSpaceKitContext === void 0 ? void 0 : setSpaceKitContext(function (state) {\n      if (state === void 0) {\n        state = defaultState;\n      }\n\n      if (!state.singletonComponents[identity]) {\n        // This should never happen; we should never be trying to decrement\n        // something that isn't rendered.\n        return state;\n      }\n\n      if (state.singletonComponents[identity].instanceCount.current === 1) {\n        // This is the last instance; delete it from the component and return\n        // a new state to trigger a re-render.\n        var singletonComponentsCopy = _tslib.__assign({}, state.singletonComponents);\n\n        delete singletonComponentsCopy[identity];\n        return _tslib.__assign(_tslib.__assign({}, state), {\n          singletonComponents: singletonComponentsCopy\n        });\n      } // Decrement the instance count and return the original `state` so this\n      // won't trigger a re-render.\n\n\n      state.singletonComponents[identity].instanceCount.current -= 1;\n      return state;\n    });\n  }, [setSpaceKitContext]);\n  var show = React__default.useCallback(function (_a) {\n    var identity = _a.identity,\n        element = _a.element;\n    setSpaceKitContext === null || setSpaceKitContext === void 0 ? void 0 : setSpaceKitContext(function (previousState) {\n      var _a;\n\n      if (previousState === void 0) {\n        previousState = defaultState;\n      }\n\n      if (!previousState.singletonComponents[identity]) {\n        // This is the first time ths identity is being rendered. Create the\n        // entry in `singletonComponents` and modify `state` to trigger a\n        // re-render.\n        return _tslib.__assign(_tslib.__assign({}, previousState), {\n          singletonComponents: _tslib.__assign(_tslib.__assign({}, previousState.singletonComponents), (_a = {}, _a[identity] = {\n            element: element,\n            instanceCount: {\n              current: 1\n            }\n          }, _a))\n        });\n      } // This identity exists. Increment the instanceCount and return the\n      // original state to avoid a re-render.\n\n\n      previousState.singletonComponents[identity].instanceCount.current += 1;\n      return previousState;\n    });\n  }, [setSpaceKitContext]);\n  return {\n    hide: hide,\n    show: show\n  };\n}\n\nexports.SpaceKitProvider = SpaceKitProvider;\nexports.useHasSpaceKitProvider = useHasSpaceKitProvider;\nexports.useSingletonComponent = useSingletonComponent;\nexports.useSpaceKitProvider = useSpaceKitProvider;","map":{"version":3,"sources":["../src/SpaceKitProvider/index.tsx"],"names":["defaultState","disableAnimations","singletonComponents","theme","SpaceKitStateContext","React","SpaceKitSetContext","SpaceKitProvider","children","nextState","useMemo","_c","state","setState","useEffect","currState","value","identity","element","key","useHasSpaceKitProvider","useSpaceKitProvider","context","useSingletonComponent","setSpaceKitContext","hide","singletonComponentsCopy","show","previousState","instanceCount","current"],"mappings":"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","sourcesContent":["import React, { useEffect, useMemo } from \"react\";\n\ninterface State {\n  /**\n   * Disable all JavaScript based animations\n   *\n   * This includes Framer Motion animations and manual css values.\n   *\n   * @default false\n   */\n  disableAnimations: boolean;\n\n  singletonComponents: Record<\n    string,\n    {\n      element: ReturnType<React.FC>;\n      instanceCount: React.MutableRefObject<number>;\n    }\n  >;\n\n  theme: \"light\" | \"dark\";\n}\n\nconst defaultState: State = {\n  disableAnimations: false,\n  singletonComponents: {},\n  theme: \"light\",\n};\n\n// This implementation is based on the excellent blog post by Kent C. Dodds on\n// How to use React Context effectively:\n// https://kentcdodds.com/blog/how-to-use-react-context-effectively\n\nconst SpaceKitStateContext = React.createContext<State | undefined>(undefined);\nconst SpaceKitSetContext = React.createContext<\n  React.Dispatch<React.SetStateAction<State>> | undefined\n>(undefined);\n\n/**\n * Provider to set options on all Space Kit components\n *\n * This is completely optional; components will not have issues if this is\n * missing from the context.\n *\n * A good place to use this would be in your storybook configuration as a\n * decorator applied to all components if we're running inside of chromatic.\n */\nexport const SpaceKitProvider: React.FC<Partial<\n  Pick<State, \"theme\" | \"disableAnimations\">\n>> = ({ children, theme, disableAnimations }) => {\n  const nextState = useMemo(\n    () => ({\n      theme: theme ?? defaultState.theme,\n      disableAnimations: disableAnimations ?? defaultState.disableAnimations,\n      singletonComponents: {},\n    }),\n    [theme, disableAnimations],\n  );\n  const [state, setState] = React.useState<State>(nextState);\n\n  useEffect(() => {\n    setState((currState) => ({\n      ...nextState,\n      singletonComponents: currState.singletonComponents,\n    }));\n  }, [nextState]);\n\n  return (\n    <SpaceKitStateContext.Provider value={state}>\n      <SpaceKitSetContext.Provider value={setState}>\n        {Object.entries(state?.singletonComponents ?? {}).map(\n          ([identity, { element }]) => {\n            return <React.Fragment key={identity}>{element}</React.Fragment>;\n          },\n        )}\n        {children}\n      </SpaceKitSetContext.Provider>\n    </SpaceKitStateContext.Provider>\n  );\n};\n\n/**\n * Hook to indicate if the current component is being rendered inside of a\n * `SpaceKitProvider`\n */\nexport function useHasSpaceKitProvider(): boolean {\n  return !!React.useContext(SpaceKitStateContext);\n}\n\n/**\n * Hook to get the values from the Space Kit Provider with sensible defaults for\n * all the values.\n *\n * This component does _not_ require us to be wrapped with `SpaceKitProvider`\n */\nexport function useSpaceKitProvider(): Readonly<State> {\n  const context = React.useContext(SpaceKitStateContext);\n\n  if (context == null) {\n    // Provide a default because consumers are not required to wrap their\n    // components with our providers\n    return defaultState;\n  }\n\n  return context;\n}\n\n/**\n * Hook intended to be used internally to communicate with `SpaceKitProvider`\n * indicating singleton components being mounted and unmounted.\n *\n * Use `show` to track when you show a component.\n *\n * Use `hide` to track when you remove a component.\n */\nexport function useSingletonComponent(): {\n  hide: ({ identity }: { identity: string }) => void;\n  show: ({\n    identity,\n    element,\n  }: {\n    identity: string;\n    element: ReturnType<React.FC>;\n  }) => void;\n} {\n  const setSpaceKitContext = React.useContext(SpaceKitSetContext);\n\n  const hide = React.useCallback(\n    ({ identity }: { identity: string }) => {\n      setSpaceKitContext?.((state = defaultState) => {\n        if (!state.singletonComponents[identity]) {\n          // This should never happen; we should never be trying to decrement\n          // something that isn't rendered.\n          return state;\n        }\n\n        if (state.singletonComponents[identity].instanceCount.current === 1) {\n          // This is the last instance; delete it from the component and return\n          // a new state to trigger a re-render.\n          const singletonComponentsCopy = { ...state.singletonComponents };\n          delete singletonComponentsCopy[identity];\n\n          return {\n            ...state,\n            singletonComponents: singletonComponentsCopy,\n          };\n        }\n\n        // Decrement the instance count and return the original `state` so this\n        // won't trigger a re-render.\n        state.singletonComponents[identity].instanceCount.current -= 1;\n        return state;\n      });\n    },\n    [setSpaceKitContext],\n  );\n\n  const show = React.useCallback(\n    ({\n      identity,\n      element,\n    }: {\n      identity: string;\n      element: ReturnType<React.FC>;\n    }) => {\n      setSpaceKitContext?.((previousState = defaultState) => {\n        if (!previousState.singletonComponents[identity]) {\n          // This is the first time ths identity is being rendered. Create the\n          // entry in `singletonComponents` and modify `state` to trigger a\n          // re-render.\n          return {\n            ...previousState,\n            singletonComponents: {\n              ...previousState.singletonComponents,\n              [identity]: { element, instanceCount: { current: 1 } },\n            },\n          };\n        }\n\n        // This identity exists. Increment the instanceCount and return the\n        // original state to avoid a re-render.\n        previousState.singletonComponents[identity].instanceCount.current += 1;\n        return previousState;\n      });\n    },\n    [setSpaceKitContext],\n  );\n\n  return { hide, show };\n}\n"]},"metadata":{},"sourceType":"script"}